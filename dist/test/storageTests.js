"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var testType_1 = require("./testType");
var plump_1 = require("plump");
var mergeOptions = require("merge-options");
var chai = require("chai");
var chaiAsPromised = require("chai-as-promised");
chai.use(chaiAsPromised);
var expect = chai.expect;
var sampleObject = {
    typeName: 'tests',
    attributes: {
        name: 'potato',
        extended: {
            actual: 'rutabaga',
            otherValue: 42,
        },
    },
    relationships: {},
};
function testSuite(context, storeOpts) {
    var store = Object.assign({}, {
        before: function () { return Promise.resolve(); },
        after: function () { return Promise.resolve(); },
    }, storeOpts);
    context.describe(store.name, function () {
        var actualStore;
        context.before(function () {
            return (store.before || (function () { return Promise.resolve(); }))(actualStore)
                .then(function () {
                actualStore = new store.ctor(store.opts);
                actualStore.addSchema(testType_1.TestType);
            });
        });
        context.describe('core CRUD', function () {
            context.it('supports creating values with no id field, and retrieving values', function () {
                return actualStore.writeAttributes(sampleObject)
                    .then(function (createdObject) {
                    return actualStore.read({ typeName: 'tests', id: createdObject.id }, ['attributes', 'relationships'])
                        .then(function (v) {
                        return expect(v)
                            .to.deep.equal(mergeOptions({}, sampleObject, {
                            id: createdObject.id,
                            relationships: {
                                parents: [],
                                children: [],
                                valenceParents: [],
                                valenceChildren: [],
                                queryParents: [],
                                queryChildren: [],
                            },
                            attributes: {
                                id: createdObject.id,
                                otherName: '',
                            },
                        }));
                    });
                });
            });
            context.it('allows objects to be stored by id', function () {
                return actualStore.writeAttributes(sampleObject)
                    .then(function (createdObject) {
                    var modObject = mergeOptions({}, createdObject, { attributes: { name: 'carrot' } });
                    return actualStore.writeAttributes(modObject)
                        .then(function (updatedObject) {
                        return expect(actualStore.read({ typeName: 'tests', id: updatedObject.id }, 'attributes'))
                            .to.eventually.deep.equal(mergeOptions({}, modObject, {
                            id: createdObject.id,
                            relationships: {},
                            attributes: {
                                id: createdObject.id,
                                otherName: '',
                            },
                        }));
                    });
                });
            });
            context.it('allows for deletion of objects by id', function () {
                return actualStore.writeAttributes(sampleObject)
                    .then(function (createdObject) {
                    return expect(actualStore.read({ typeName: 'tests', id: createdObject.id }))
                        .to.eventually.have.deep.property('attributes.name', 'potato')
                        .then(function () { return actualStore.delete({ typeName: 'tests', id: createdObject.id }); })
                        .then(function () { return expect(actualStore.read({ typeName: 'tests', id: createdObject.id })).to.eventually.be.null; });
                });
            });
        });
        context.describe('relationships', function () {
            context.it('can fetch a base and hasmany in one read', function () {
                return actualStore.writeAttributes(sampleObject)
                    .then(function (createdObject) {
                    return actualStore.writeRelationshipItem({ typeName: 'tests', id: createdObject.id }, 'children', { id: 200 })
                        .then(function () { return actualStore.writeRelationshipItem({ typeName: 'tests', id: createdObject.id }, 'children', { id: 201 }); })
                        .then(function () { return actualStore.writeRelationshipItem({ typeName: 'tests', id: createdObject.id }, 'children', { id: 202 }); })
                        .then(function () { return actualStore.writeRelationshipItem({ typeName: 'tests', id: createdObject.id }, 'children', { id: 203 }); })
                        .then(function () {
                        return actualStore.read({ typeName: 'tests', id: createdObject.id }, ['attributes', 'relationships.children']);
                    })
                        .then(function (v) {
                        expect(v).to.have.deep.property('attributes.name', 'potato');
                        expect(v.relationships.children).to.deep.equal([{ id: 200 }, { id: 201 }, { id: 202 }, { id: 203 }]);
                    });
                });
            });
            context.it('can add to a hasMany relationship', function () {
                return actualStore.writeAttributes(sampleObject)
                    .then(function (createdObject) {
                    return actualStore.writeRelationshipItem({ typeName: 'tests', id: createdObject.id }, 'children', { id: 100 })
                        .then(function () { return actualStore.writeRelationshipItem({ typeName: 'tests', id: createdObject.id }, 'children', { id: 101 }); })
                        .then(function () { return actualStore.writeRelationshipItem({ typeName: 'tests', id: createdObject.id }, 'children', { id: 102 }); })
                        .then(function () { return actualStore.writeRelationshipItem({ typeName: 'tests', id: createdObject.id }, 'children', { id: 103 }); })
                        .then(function () { return actualStore.writeRelationshipItem({ typeName: 'tests', id: 100 }, 'children', { id: createdObject.id }); })
                        .then(function () { return actualStore.read({ typeName: 'tests', id: createdObject.id }, ['relationships.children']); })
                        .then(function (v) {
                        expect(v.relationships.children).to.deep.equal([
                            { id: 100 },
                            { id: 101 },
                            { id: 102 },
                            { id: 103 },
                        ]);
                        return actualStore.read({ typeName: 'tests', id: createdObject.id }, ['relationships.parents']);
                    })
                        .then(function (v) { return expect(v.relationships.parents).to.deep.equal([{ id: 100 }]); });
                });
            });
            context.it('can add to a hasMany relationship with extras', function () {
                return actualStore.writeAttributes(sampleObject)
                    .then(function (createdObject) {
                    return actualStore.writeRelationshipItem({ typeName: 'tests', id: createdObject.id }, 'valenceChildren', { id: 100, meta: { perm: 1 } })
                        .then(function () { return actualStore.read({ typeName: 'tests', id: createdObject.id }, 'relationships.valenceChildren'); })
                        .then(function (v) { return expect(v.relationships.valenceChildren).to.deep.equal([{ id: 100, meta: { perm: 1 } }]); });
                });
            });
            context.it('can modify valence on a hasMany relationship', function () {
                return actualStore.writeAttributes(sampleObject)
                    .then(function (createdObject) {
                    return actualStore.writeRelationshipItem({ typeName: 'tests', id: createdObject.id }, 'valenceChildren', { id: 100, meta: { perm: 1 } })
                        .then(function () { return actualStore.read({ typeName: 'tests', id: createdObject.id }, 'relationships.valenceChildren'); })
                        .then(function (v) { return expect(v.relationships.valenceChildren).to.deep.equal([{ id: 100, meta: { perm: 1 } }]); })
                        .then(function () {
                        return actualStore.writeRelationshipItem({ typeName: 'tests', id: createdObject.id }, 'valenceChildren', { id: 100, meta: { perm: 2 } });
                    })
                        .then(function () { return actualStore.read({ typeName: 'tests', id: createdObject.id }, 'relationships.valenceChildren'); })
                        .then(function (v) { return expect(v.relationships.valenceChildren).to.deep.equal([{ id: 100, meta: { perm: 2 } }]); });
                });
            });
            context.it('can remove from a hasMany relationship', function () {
                return actualStore.writeAttributes(sampleObject)
                    .then(function (createdObject) {
                    return actualStore.writeRelationshipItem({ typeName: 'tests', id: createdObject.id }, 'children', { id: 100 })
                        .then(function () { return actualStore.read({ typeName: 'tests', id: createdObject.id }, 'relationships.children'); })
                        .then(function (v) { return expect(v.relationships.children).to.deep.equal([{ id: 100 }]); })
                        .then(function () { return actualStore.deleteRelationshipItem({ typeName: 'tests', id: createdObject.id }, 'children', { id: 100 }); })
                        .then(function () { return actualStore.read({ typeName: 'tests', id: createdObject.id }, 'relationships.children'); })
                        .then(function (v) { return expect(v.relationships.children).to.deep.equal([]); });
                });
            });
        });
        context.describe('events', function () {
            context.it('should pass basic write-invalidation events to other datastores', function () {
                var memstore = new plump_1.MemoryStore();
                var testPlump = new plump_1.Plump();
                return testPlump.addCache(memstore)
                    .then(function () { return testPlump.setTerminal(actualStore); })
                    .then(function () { return testPlump.addType(testType_1.TestType); })
                    .then(function () { return actualStore.writeAttributes({ typeName: 'tests', attributes: { name: 'potato' } }); })
                    .then(function (createdObject) {
                    return actualStore.read({ typeName: 'tests', id: createdObject.id })
                        .then(function () {
                        return new Promise(function (resolve) { return setTimeout(resolve, 100); })
                            .then(function () {
                            return expect(memstore.read({ typeName: 'tests', id: createdObject.id }))
                                .to.eventually.have.deep.property('attributes.name', 'potato');
                        }).then(function () {
                            return actualStore.writeAttributes({
                                typeName: 'tests',
                                id: createdObject.id,
                                attributes: {
                                    name: 'grotato',
                                },
                            });
                        }).then(function () {
                            return new Promise(function (resolve) { return setTimeout(resolve, 100); });
                        }).then(function () {
                            return expect(memstore.read({ typeName: 'tests', id: createdObject.id }))
                                .to.eventually.be.null;
                        });
                    });
                })
                    .then(function () {
                    return testPlump.teardown();
                })
                    .catch(function (err) {
                    testPlump.teardown();
                    throw err;
                });
            });
            context.it('should pass basic cacheable-read events up the stack', function () {
                var testPlump = new plump_1.Plump();
                var testItem;
                var memstore;
                return testPlump.addType(testType_1.TestType)
                    .then(function () { return actualStore.writeAttributes({ typeName: 'tests', attributes: { name: 'potato' } }); })
                    .then(function (createdObject) {
                    testItem = createdObject;
                    return expect(actualStore.read({ typeName: 'tests', id: testItem.id }))
                        .to.eventually.have.deep.property('attributes.name', 'potato');
                }).then(function () {
                    memstore = new plump_1.MemoryStore();
                    testPlump.addCache(memstore);
                    testPlump.setTerminal(actualStore);
                    return expect(memstore.read({ typeName: 'tests', id: testItem.id })).to.eventually.be.null;
                }).then(function () {
                    return actualStore.read({ typeName: 'tests', id: testItem.id });
                })
                    .then(function () {
                    return new Promise(function (resolve) { return setTimeout(resolve, 100); });
                })
                    .then(function () {
                    return expect(memstore.read({ typeName: 'tests', id: testItem.id }))
                        .to.eventually.have.deep.property('attributes.name', 'potato');
                })
                    .then(function () {
                    return testPlump.teardown();
                })
                    .catch(function (err) {
                    testPlump.teardown();
                    throw err;
                });
            });
            context.it('should pass write-invalidation events on hasMany relationships to other datastores', function () {
                var testItem;
                var memstore = new plump_1.MemoryStore();
                var testPlump = new plump_1.Plump();
                return testPlump.addType(testType_1.TestType)
                    .then(function () { return testPlump.addCache(memstore); })
                    .then(function () { return testPlump.setTerminal(actualStore); })
                    .then(function () { return actualStore.writeAttributes({ typeName: 'tests', attributes: { name: 'potato' } }); })
                    .then(function (createdObject) {
                    testItem = createdObject;
                    return expect(actualStore.read({ typeName: 'tests', id: testItem.id }))
                        .to.eventually.have.deep.property('attributes.name', 'potato');
                }).then(function () { return actualStore.writeRelationshipItem({ typeName: 'tests', id: testItem.id }, 'children', { id: 100 }); })
                    .then(function () {
                    return expect(memstore.read({ typeName: 'tests', id: testItem.id }))
                        .to.eventually.not.have.deep.property('relationships.children');
                }).then(function () {
                    return actualStore.read({ typeName: 'tests', id: testItem.id }, 'children');
                }).then(function () {
                    return new Promise(function (resolve) { return setTimeout(resolve, 100); });
                })
                    .then(function () { return memstore.read({ typeName: 'tests', id: testItem.id }, 'children'); })
                    .then(function (v) { return expect(v.relationships.children).to.deep.equal([{ id: 100 }]); })
                    .then(function () { return actualStore.writeRelationshipItem({ typeName: 'tests', id: testItem.id }, 'children', { id: 101 }); })
                    .then(function () { return new Promise(function (resolve) { return setTimeout(resolve, 100); }); })
                    .then(function () { return memstore.read({ typeName: 'tests', id: testItem.id }); })
                    .then(function (v) { return expect(v).to.not.have.deep.property('relationships.children'); })
                    .then(function () { return testPlump.teardown(); })
                    .catch(function (err) {
                    testPlump.teardown();
                    throw err;
                });
            });
            context.it('should pass cacheable-read events on hasMany relationships to other datastores', function () {
                var testItem;
                var memstore;
                var testPlump = new plump_1.Plump();
                return testPlump.addType(testType_1.TestType)
                    .then(function () { return actualStore.writeAttributes({ typeName: 'tests', attributes: { name: 'potato' } }); })
                    .then(function (createdObject) {
                    testItem = createdObject;
                    return expect(actualStore.read({ typeName: 'tests', id: testItem.id }))
                        .to.eventually.have.deep.property('attributes.name', 'potato');
                }).then(function () { return actualStore.writeRelationshipItem({ typeName: 'tests', id: testItem.id }, 'children', { id: 100 }); })
                    .then(function () {
                    memstore = new plump_1.MemoryStore();
                    return testPlump.setTerminal(actualStore)
                        .then(function () { return testPlump.addCache(memstore); })
                        .then(function () { return expect(memstore.read({ typeName: 'tests', id: testItem.id })).to.eventually.be.null; });
                }).then(function () {
                    return actualStore.read({ typeName: 'tests', id: testItem.id }, 'children');
                }).then(function () { return new Promise(function (resolve) { return setTimeout(resolve, 100); }); })
                    .then(function () { return memstore.read({ typeName: 'tests', id: testItem.id }, 'children'); })
                    .then(function (v) { return expect(v.relationships.children).to.deep.equal([{ id: 100 }]); })
                    .then(function () { return testPlump.teardown(); })
                    .catch(function (err) {
                    testPlump.teardown();
                    throw err;
                });
            });
        });
        context.after(function () {
            return (store.after || (function () { return; }))(actualStore);
        });
    });
}
exports.testSuite = testSuite;

//# sourceMappingURL=data:application/json;charset=utf8;base64,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QixDQUFDLEVBQWxELENBQWtELENBQUM7cUJBQ2hFLElBQUksQ0FBQyxjQUFNLE9BQUEsUUFBUSxDQUFDLElBQUksQ0FBQyxFQUFFLFFBQVEsRUFBRSxPQUFPLEVBQUUsRUFBRSxFQUFFLFFBQVEsQ0FBQyxFQUFFLEVBQUUsRUFBRSxVQUFVLENBQUMsRUFBakUsQ0FBaUUsQ0FBQztxQkFDN0UsSUFBSSxDQUFDLFVBQUMsQ0FBQyxJQUFLLE9BQUEsTUFBTSxDQUFDLENBQUMsQ0FBQyxhQUFhLENBQUMsUUFBUSxDQUFDLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFLEVBQUUsRUFBRSxHQUFHLEVBQUUsQ0FBQyxDQUFDLEVBQTdELENBQTZELENBQUM7cUJBQzFFLElBQUksQ0FBQyxjQUFNLE9BQUEsU0FBUyxDQUFDLFFBQVEsRUFBRSxFQUFwQixDQUFvQixDQUFDO3FCQUNoQyxLQUFLLENBQUMsVUFBQyxHQUFHO29CQUNULFNBQVMsQ0FBQyxRQUFRLEVBQUUsQ0FBQztvQkFDckIsTUFBTSxHQUFHLENBQUM7Z0JBQ1osQ0FBQyxDQUFDLENBQUM7WUFDTCxDQUFDLENBQUMsQ0FBQztRQUNMLENBQUMsQ0FBQyxDQUFDO1FBRUgsT0FBTyxDQUFDLEtBQUssQ0FBQztZQUNaLE1BQU0sQ0FBQyxDQUFDLEtBQUssQ0FBQyxLQUFLLElBQUksQ0FBQyxjQUFRLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsV0FBVyxDQUFDLENBQUM7UUFDM0QsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUM7QUF6VEQsOEJBeVRDIiwiZmlsZSI6InRlc3Qvc3RvcmFnZVRlc3RzLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyogZXNsaW50LWVudiBub2RlICovXG4vKiBlc2xpbnQgbm8tc2hhZG93OiAwLCBtYXgtbGVuOiAwICovXG5cbmltcG9ydCB7IFRlc3RUeXBlIH0gZnJvbSAnLi90ZXN0VHlwZSc7XG5pbXBvcnQgeyBNZW1vcnlTdG9yZSwgUGx1bXAgfSBmcm9tICdwbHVtcCc7XG5pbXBvcnQgKiBhcyBtZXJnZU9wdGlvbnMgZnJvbSAnbWVyZ2Utb3B0aW9ucyc7XG5cbmltcG9ydCAqIGFzIGNoYWkgZnJvbSAnY2hhaSc7XG5pbXBvcnQgKiBhcyBjaGFpQXNQcm9taXNlZCBmcm9tICdjaGFpLWFzLXByb21pc2VkJztcbmNoYWkudXNlKGNoYWlBc1Byb21pc2VkKTtcblxuY29uc3QgZXhwZWN0ID0gY2hhaS5leHBlY3Q7XG5cbmNvbnN0IHNhbXBsZU9iamVjdCA9IHtcbiAgdHlwZU5hbWU6ICd0ZXN0cycsXG4gIGF0dHJpYnV0ZXM6IHtcbiAgICBuYW1lOiAncG90YXRvJyxcbiAgICBleHRlbmRlZDoge1xuICAgICAgYWN0dWFsOiAncnV0YWJhZ2EnLFxuICAgICAgb3RoZXJWYWx1ZTogNDIsXG4gICAgfSxcbiAgfSxcbiAgcmVsYXRpb25zaGlwczoge30sXG59O1xuXG5leHBvcnQgZnVuY3Rpb24gdGVzdFN1aXRlKGNvbnRleHQsIHN0b3JlT3B0cyApIHtcbiAgY29uc3Qgc3RvcmUgPSBPYmplY3QuYXNzaWduKFxuICAgIHt9LFxuICAgIHtcbiAgICAgIGJlZm9yZTogKCkgPT4gUHJvbWlzZS5yZXNvbHZlKCksXG4gICAgICBhZnRlcjogKCkgPT4gUHJvbWlzZS5yZXNvbHZlKCksXG4gICAgfSxcbiAgICBzdG9yZU9wdHNcbiAgKTtcbiAgY29udGV4dC5kZXNjcmliZShzdG9yZS5uYW1lLCAoKSA9PiB7XG4gICAgbGV0IGFjdHVhbFN0b3JlO1xuICAgIGNvbnRleHQuYmVmb3JlKCgpID0+IHtcbiAgICAgIHJldHVybiAoc3RvcmUuYmVmb3JlIHx8ICgoKSA9PiBQcm9taXNlLnJlc29sdmUoKSkpKGFjdHVhbFN0b3JlKVxuICAgICAgLnRoZW4oKCkgPT4ge1xuICAgICAgICBhY3R1YWxTdG9yZSA9IG5ldyBzdG9yZS5jdG9yKHN0b3JlLm9wdHMpOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5ldy1jYXBcbiAgICAgICAgYWN0dWFsU3RvcmUuYWRkU2NoZW1hKFRlc3RUeXBlKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgY29udGV4dC5kZXNjcmliZSgnY29yZSBDUlVEJywgKCkgPT4ge1xuICAgICAgY29udGV4dC5pdCgnc3VwcG9ydHMgY3JlYXRpbmcgdmFsdWVzIHdpdGggbm8gaWQgZmllbGQsIGFuZCByZXRyaWV2aW5nIHZhbHVlcycsICgpID0+IHtcbiAgICAgICAgcmV0dXJuIGFjdHVhbFN0b3JlLndyaXRlQXR0cmlidXRlcyhzYW1wbGVPYmplY3QpXG4gICAgICAgIC50aGVuKChjcmVhdGVkT2JqZWN0KSA9PiB7XG4gICAgICAgICAgcmV0dXJuIGFjdHVhbFN0b3JlLnJlYWQoeyB0eXBlTmFtZTogJ3Rlc3RzJywgaWQ6IGNyZWF0ZWRPYmplY3QuaWQgfSwgWydhdHRyaWJ1dGVzJywgJ3JlbGF0aW9uc2hpcHMnXSlcbiAgICAgICAgICAudGhlbigodikgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIGV4cGVjdCh2KVxuICAgICAgICAgICAgLnRvLmRlZXAuZXF1YWwoXG4gICAgICAgICAgICAgIG1lcmdlT3B0aW9ucyh7fSwgc2FtcGxlT2JqZWN0LCB7XG4gICAgICAgICAgICAgICAgaWQ6IGNyZWF0ZWRPYmplY3QuaWQsXG4gICAgICAgICAgICAgICAgcmVsYXRpb25zaGlwczoge1xuICAgICAgICAgICAgICAgICAgcGFyZW50czogW10sXG4gICAgICAgICAgICAgICAgICBjaGlsZHJlbjogW10sXG4gICAgICAgICAgICAgICAgICB2YWxlbmNlUGFyZW50czogW10sXG4gICAgICAgICAgICAgICAgICB2YWxlbmNlQ2hpbGRyZW46IFtdLFxuICAgICAgICAgICAgICAgICAgcXVlcnlQYXJlbnRzOiBbXSxcbiAgICAgICAgICAgICAgICAgIHF1ZXJ5Q2hpbGRyZW46IFtdLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgYXR0cmlidXRlczoge1xuICAgICAgICAgICAgICAgICAgaWQ6IGNyZWF0ZWRPYmplY3QuaWQsXG4gICAgICAgICAgICAgICAgICBvdGhlck5hbWU6ICcnLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuXG4gICAgICBjb250ZXh0Lml0KCdhbGxvd3Mgb2JqZWN0cyB0byBiZSBzdG9yZWQgYnkgaWQnLCAoKSA9PiB7XG4gICAgICAgIHJldHVybiBhY3R1YWxTdG9yZS53cml0ZUF0dHJpYnV0ZXMoc2FtcGxlT2JqZWN0KVxuICAgICAgICAudGhlbigoY3JlYXRlZE9iamVjdCkgPT4ge1xuICAgICAgICAgIGNvbnN0IG1vZE9iamVjdCA9IG1lcmdlT3B0aW9ucyh7fSwgY3JlYXRlZE9iamVjdCwgeyBhdHRyaWJ1dGVzOiB7IG5hbWU6ICdjYXJyb3QnIH0gfSk7XG4gICAgICAgICAgcmV0dXJuIGFjdHVhbFN0b3JlLndyaXRlQXR0cmlidXRlcyhtb2RPYmplY3QpXG4gICAgICAgICAgLnRoZW4oKHVwZGF0ZWRPYmplY3QpID0+IHtcbiAgICAgICAgICAgIHJldHVybiBleHBlY3QoYWN0dWFsU3RvcmUucmVhZCh7IHR5cGVOYW1lOiAndGVzdHMnLCBpZDogdXBkYXRlZE9iamVjdC5pZCB9LCAnYXR0cmlidXRlcycpKVxuICAgICAgICAgICAgICAudG8uZXZlbnR1YWxseS5kZWVwLmVxdWFsKFxuICAgICAgICAgICAgICBtZXJnZU9wdGlvbnMoe30sIG1vZE9iamVjdCwge1xuICAgICAgICAgICAgICAgIGlkOiBjcmVhdGVkT2JqZWN0LmlkLFxuICAgICAgICAgICAgICAgIHJlbGF0aW9uc2hpcHM6IHt9LFxuICAgICAgICAgICAgICAgIGF0dHJpYnV0ZXM6IHtcbiAgICAgICAgICAgICAgICAgIGlkOiBjcmVhdGVkT2JqZWN0LmlkLFxuICAgICAgICAgICAgICAgICAgb3RoZXJOYW1lOiAnJyxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcblxuICAgICAgY29udGV4dC5pdCgnYWxsb3dzIGZvciBkZWxldGlvbiBvZiBvYmplY3RzIGJ5IGlkJywgKCkgPT4ge1xuICAgICAgICByZXR1cm4gYWN0dWFsU3RvcmUud3JpdGVBdHRyaWJ1dGVzKHNhbXBsZU9iamVjdClcbiAgICAgICAgLnRoZW4oKGNyZWF0ZWRPYmplY3QpID0+IHtcbiAgICAgICAgICByZXR1cm4gZXhwZWN0KGFjdHVhbFN0b3JlLnJlYWQoeyB0eXBlTmFtZTogJ3Rlc3RzJywgaWQ6IGNyZWF0ZWRPYmplY3QuaWQgfSkpXG4gICAgICAgICAgLnRvLmV2ZW50dWFsbHkuaGF2ZS5kZWVwLnByb3BlcnR5KCdhdHRyaWJ1dGVzLm5hbWUnLCAncG90YXRvJylcbiAgICAgICAgICAudGhlbigoKSA9PiBhY3R1YWxTdG9yZS5kZWxldGUoeyB0eXBlTmFtZTogJ3Rlc3RzJywgaWQ6IGNyZWF0ZWRPYmplY3QuaWQgfSkpXG4gICAgICAgICAgLnRoZW4oKCkgPT4gZXhwZWN0KGFjdHVhbFN0b3JlLnJlYWQoeyB0eXBlTmFtZTogJ3Rlc3RzJywgaWQ6IGNyZWF0ZWRPYmplY3QuaWQgfSkpLnRvLmV2ZW50dWFsbHkuYmUubnVsbCk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBjb250ZXh0LmRlc2NyaWJlKCdyZWxhdGlvbnNoaXBzJywgKCkgPT4ge1xuICAgICAgY29udGV4dC5pdCgnY2FuIGZldGNoIGEgYmFzZSBhbmQgaGFzbWFueSBpbiBvbmUgcmVhZCcsICgpID0+IHtcbiAgICAgICAgcmV0dXJuIGFjdHVhbFN0b3JlLndyaXRlQXR0cmlidXRlcyhzYW1wbGVPYmplY3QpXG4gICAgICAgIC50aGVuKChjcmVhdGVkT2JqZWN0KSA9PiB7XG4gICAgICAgICAgcmV0dXJuIGFjdHVhbFN0b3JlLndyaXRlUmVsYXRpb25zaGlwSXRlbSh7IHR5cGVOYW1lOiAndGVzdHMnLCBpZDogY3JlYXRlZE9iamVjdC5pZCB9LCAnY2hpbGRyZW4nLCB7IGlkOiAyMDAgfSlcbiAgICAgICAgICAudGhlbigoKSA9PiBhY3R1YWxTdG9yZS53cml0ZVJlbGF0aW9uc2hpcEl0ZW0oeyB0eXBlTmFtZTogJ3Rlc3RzJywgaWQ6IGNyZWF0ZWRPYmplY3QuaWQgfSwgJ2NoaWxkcmVuJywgeyBpZDogMjAxIH0pKVxuICAgICAgICAgIC50aGVuKCgpID0+IGFjdHVhbFN0b3JlLndyaXRlUmVsYXRpb25zaGlwSXRlbSh7IHR5cGVOYW1lOiAndGVzdHMnLCBpZDogY3JlYXRlZE9iamVjdC5pZCB9LCAnY2hpbGRyZW4nLCB7IGlkOiAyMDIgfSkpXG4gICAgICAgICAgLnRoZW4oKCkgPT4gYWN0dWFsU3RvcmUud3JpdGVSZWxhdGlvbnNoaXBJdGVtKHsgdHlwZU5hbWU6ICd0ZXN0cycsIGlkOiBjcmVhdGVkT2JqZWN0LmlkIH0sICdjaGlsZHJlbicsIHsgaWQ6IDIwMyB9KSlcbiAgICAgICAgICAudGhlbigoKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gYWN0dWFsU3RvcmUucmVhZCh7IHR5cGVOYW1lOiAndGVzdHMnLCBpZDogY3JlYXRlZE9iamVjdC5pZCB9LCBbJ2F0dHJpYnV0ZXMnLCAncmVsYXRpb25zaGlwcy5jaGlsZHJlbiddKTtcbiAgICAgICAgICB9KVxuICAgICAgICAgIC50aGVuKCh2KSA9PiB7XG4gICAgICAgICAgICBleHBlY3QodikudG8uaGF2ZS5kZWVwLnByb3BlcnR5KCdhdHRyaWJ1dGVzLm5hbWUnLCAncG90YXRvJyk7XG4gICAgICAgICAgICBleHBlY3Qodi5yZWxhdGlvbnNoaXBzLmNoaWxkcmVuKS50by5kZWVwLmVxdWFsKFt7IGlkOiAyMDAgfSwgeyBpZDogMjAxIH0sIHsgaWQ6IDIwMiB9LCB7IGlkOiAyMDMgfV0pO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuXG4gICAgICBjb250ZXh0Lml0KCdjYW4gYWRkIHRvIGEgaGFzTWFueSByZWxhdGlvbnNoaXAnLCAoKSA9PiB7XG4gICAgICAgIHJldHVybiBhY3R1YWxTdG9yZS53cml0ZUF0dHJpYnV0ZXMoc2FtcGxlT2JqZWN0KVxuICAgICAgICAudGhlbigoY3JlYXRlZE9iamVjdCkgPT4ge1xuICAgICAgICAgIHJldHVybiBhY3R1YWxTdG9yZS53cml0ZVJlbGF0aW9uc2hpcEl0ZW0oeyB0eXBlTmFtZTogJ3Rlc3RzJywgaWQ6IGNyZWF0ZWRPYmplY3QuaWQgfSwgJ2NoaWxkcmVuJywgeyBpZDogMTAwIH0pXG4gICAgICAgICAgLnRoZW4oKCkgPT4gYWN0dWFsU3RvcmUud3JpdGVSZWxhdGlvbnNoaXBJdGVtKHsgdHlwZU5hbWU6ICd0ZXN0cycsIGlkOiBjcmVhdGVkT2JqZWN0LmlkIH0sICdjaGlsZHJlbicsIHsgaWQ6IDEwMSB9KSlcbiAgICAgICAgICAudGhlbigoKSA9PiBhY3R1YWxTdG9yZS53cml0ZVJlbGF0aW9uc2hpcEl0ZW0oeyB0eXBlTmFtZTogJ3Rlc3RzJywgaWQ6IGNyZWF0ZWRPYmplY3QuaWQgfSwgJ2NoaWxkcmVuJywgeyBpZDogMTAyIH0pKVxuICAgICAgICAgIC50aGVuKCgpID0+IGFjdHVhbFN0b3JlLndyaXRlUmVsYXRpb25zaGlwSXRlbSh7IHR5cGVOYW1lOiAndGVzdHMnLCBpZDogY3JlYXRlZE9iamVjdC5pZCB9LCAnY2hpbGRyZW4nLCB7IGlkOiAxMDMgfSkpXG4gICAgICAgICAgLnRoZW4oKCkgPT4gYWN0dWFsU3RvcmUud3JpdGVSZWxhdGlvbnNoaXBJdGVtKHsgdHlwZU5hbWU6ICd0ZXN0cycsIGlkOiAxMDAgfSwgJ2NoaWxkcmVuJywgeyBpZDogY3JlYXRlZE9iamVjdC5pZCB9KSlcbiAgICAgICAgICAudGhlbigoKSA9PiBhY3R1YWxTdG9yZS5yZWFkKHsgdHlwZU5hbWU6ICd0ZXN0cycsIGlkOiBjcmVhdGVkT2JqZWN0LmlkIH0sIFsncmVsYXRpb25zaGlwcy5jaGlsZHJlbiddKSlcbiAgICAgICAgICAudGhlbigodikgPT4ge1xuICAgICAgICAgICAgZXhwZWN0KHYucmVsYXRpb25zaGlwcy5jaGlsZHJlbikudG8uZGVlcC5lcXVhbChbXG4gICAgICAgICAgICAgIHsgaWQ6IDEwMCB9LFxuICAgICAgICAgICAgICB7IGlkOiAxMDEgfSxcbiAgICAgICAgICAgICAgeyBpZDogMTAyIH0sXG4gICAgICAgICAgICAgIHsgaWQ6IDEwMyB9LFxuICAgICAgICAgICAgXSk7XG4gICAgICAgICAgICByZXR1cm4gYWN0dWFsU3RvcmUucmVhZCh7IHR5cGVOYW1lOiAndGVzdHMnLCBpZDogY3JlYXRlZE9iamVjdC5pZCB9LCBbJ3JlbGF0aW9uc2hpcHMucGFyZW50cyddKTtcbiAgICAgICAgICB9KVxuICAgICAgICAgIC50aGVuKCh2KSA9PiBleHBlY3Qodi5yZWxhdGlvbnNoaXBzLnBhcmVudHMpLnRvLmRlZXAuZXF1YWwoW3sgaWQ6IDEwMCB9XSkpO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuXG4gICAgICBjb250ZXh0Lml0KCdjYW4gYWRkIHRvIGEgaGFzTWFueSByZWxhdGlvbnNoaXAgd2l0aCBleHRyYXMnLCAoKSA9PiB7XG4gICAgICAgIHJldHVybiBhY3R1YWxTdG9yZS53cml0ZUF0dHJpYnV0ZXMoc2FtcGxlT2JqZWN0KVxuICAgICAgICAudGhlbigoY3JlYXRlZE9iamVjdCkgPT4ge1xuICAgICAgICAgIHJldHVybiBhY3R1YWxTdG9yZS53cml0ZVJlbGF0aW9uc2hpcEl0ZW0oXG4gICAgICAgICAgICB7IHR5cGVOYW1lOiAndGVzdHMnLCBpZDogY3JlYXRlZE9iamVjdC5pZCB9LFxuICAgICAgICAgICAgJ3ZhbGVuY2VDaGlsZHJlbicsXG4gICAgICAgICAgICB7IGlkOiAxMDAsIG1ldGE6IHsgcGVybTogMSB9IH1cbiAgICAgICAgICApXG4gICAgICAgICAgLnRoZW4oKCkgPT4gYWN0dWFsU3RvcmUucmVhZCh7IHR5cGVOYW1lOiAndGVzdHMnLCBpZDogY3JlYXRlZE9iamVjdC5pZCB9LCAncmVsYXRpb25zaGlwcy52YWxlbmNlQ2hpbGRyZW4nKSlcbiAgICAgICAgICAudGhlbigodikgPT4gZXhwZWN0KHYucmVsYXRpb25zaGlwcy52YWxlbmNlQ2hpbGRyZW4pLnRvLmRlZXAuZXF1YWwoW3sgaWQ6IDEwMCwgbWV0YTogeyBwZXJtOiAxIH0gfV0pKTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcblxuICAgICAgY29udGV4dC5pdCgnY2FuIG1vZGlmeSB2YWxlbmNlIG9uIGEgaGFzTWFueSByZWxhdGlvbnNoaXAnLCAoKSA9PiB7XG4gICAgICAgIHJldHVybiBhY3R1YWxTdG9yZS53cml0ZUF0dHJpYnV0ZXMoc2FtcGxlT2JqZWN0KVxuICAgICAgICAudGhlbigoY3JlYXRlZE9iamVjdCkgPT4ge1xuICAgICAgICAgIHJldHVybiBhY3R1YWxTdG9yZS53cml0ZVJlbGF0aW9uc2hpcEl0ZW0oXG4gICAgICAgICAgICB7IHR5cGVOYW1lOiAndGVzdHMnLCBpZDogY3JlYXRlZE9iamVjdC5pZCB9LFxuICAgICAgICAgICAgJ3ZhbGVuY2VDaGlsZHJlbicsXG4gICAgICAgICAgICB7IGlkOiAxMDAsIG1ldGE6IHsgcGVybTogMSB9IH1cbiAgICAgICAgICApXG4gICAgICAgICAgLnRoZW4oKCkgPT4gYWN0dWFsU3RvcmUucmVhZCh7IHR5cGVOYW1lOiAndGVzdHMnLCBpZDogY3JlYXRlZE9iamVjdC5pZCB9LCAncmVsYXRpb25zaGlwcy52YWxlbmNlQ2hpbGRyZW4nKSlcbiAgICAgICAgICAudGhlbigodikgPT4gZXhwZWN0KHYucmVsYXRpb25zaGlwcy52YWxlbmNlQ2hpbGRyZW4pLnRvLmRlZXAuZXF1YWwoW3sgaWQ6IDEwMCwgbWV0YTogeyBwZXJtOiAxIH0gfV0pKVxuICAgICAgICAgIC50aGVuKCgpID0+XG4gICAgICAgICAgICBhY3R1YWxTdG9yZS53cml0ZVJlbGF0aW9uc2hpcEl0ZW0oXG4gICAgICAgICAgICAgIHsgdHlwZU5hbWU6ICd0ZXN0cycsIGlkOiBjcmVhdGVkT2JqZWN0LmlkIH0sXG4gICAgICAgICAgICAgICd2YWxlbmNlQ2hpbGRyZW4nLCB7IGlkOiAxMDAsIG1ldGE6IHsgcGVybTogMiB9IH1cbiAgICAgICAgICAgIClcbiAgICAgICAgICApXG4gICAgICAgICAgLnRoZW4oKCkgPT4gYWN0dWFsU3RvcmUucmVhZCh7IHR5cGVOYW1lOiAndGVzdHMnLCBpZDogY3JlYXRlZE9iamVjdC5pZCB9LCAncmVsYXRpb25zaGlwcy52YWxlbmNlQ2hpbGRyZW4nKSlcbiAgICAgICAgICAudGhlbigodikgPT4gZXhwZWN0KHYucmVsYXRpb25zaGlwcy52YWxlbmNlQ2hpbGRyZW4pLnRvLmRlZXAuZXF1YWwoW3sgaWQ6IDEwMCwgbWV0YTogeyBwZXJtOiAyIH0gfV0pKTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcblxuICAgICAgY29udGV4dC5pdCgnY2FuIHJlbW92ZSBmcm9tIGEgaGFzTWFueSByZWxhdGlvbnNoaXAnLCAoKSA9PiB7XG4gICAgICAgIHJldHVybiBhY3R1YWxTdG9yZS53cml0ZUF0dHJpYnV0ZXMoc2FtcGxlT2JqZWN0KVxuICAgICAgICAudGhlbigoY3JlYXRlZE9iamVjdCkgPT4ge1xuICAgICAgICAgIHJldHVybiBhY3R1YWxTdG9yZS53cml0ZVJlbGF0aW9uc2hpcEl0ZW0oeyB0eXBlTmFtZTogJ3Rlc3RzJywgaWQ6IGNyZWF0ZWRPYmplY3QuaWQgfSwgJ2NoaWxkcmVuJywgeyBpZDogMTAwIH0pXG4gICAgICAgICAgLnRoZW4oKCkgPT4gYWN0dWFsU3RvcmUucmVhZCh7IHR5cGVOYW1lOiAndGVzdHMnLCBpZDogY3JlYXRlZE9iamVjdC5pZCB9LCAncmVsYXRpb25zaGlwcy5jaGlsZHJlbicpKVxuICAgICAgICAgIC50aGVuKCh2KSA9PiBleHBlY3Qodi5yZWxhdGlvbnNoaXBzLmNoaWxkcmVuKS50by5kZWVwLmVxdWFsKFt7IGlkOiAxMDAgfV0pKVxuICAgICAgICAgIC50aGVuKCgpID0+IGFjdHVhbFN0b3JlLmRlbGV0ZVJlbGF0aW9uc2hpcEl0ZW0oeyB0eXBlTmFtZTogJ3Rlc3RzJywgaWQ6IGNyZWF0ZWRPYmplY3QuaWQgfSwgJ2NoaWxkcmVuJywgeyBpZDogMTAwIH0pKVxuICAgICAgICAgIC50aGVuKCgpID0+IGFjdHVhbFN0b3JlLnJlYWQoeyB0eXBlTmFtZTogJ3Rlc3RzJywgaWQ6IGNyZWF0ZWRPYmplY3QuaWQgfSwgJ3JlbGF0aW9uc2hpcHMuY2hpbGRyZW4nKSlcbiAgICAgICAgICAudGhlbigodikgPT4gZXhwZWN0KHYucmVsYXRpb25zaGlwcy5jaGlsZHJlbikudG8uZGVlcC5lcXVhbChbXSkpO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgY29udGV4dC5kZXNjcmliZSgnZXZlbnRzJywgKCkgPT4ge1xuICAgICAgY29udGV4dC5pdCgnc2hvdWxkIHBhc3MgYmFzaWMgd3JpdGUtaW52YWxpZGF0aW9uIGV2ZW50cyB0byBvdGhlciBkYXRhc3RvcmVzJywgKCkgPT4ge1xuICAgICAgICBjb25zdCBtZW1zdG9yZSA9IG5ldyBNZW1vcnlTdG9yZSgpO1xuICAgICAgICBjb25zdCB0ZXN0UGx1bXAgPSBuZXcgUGx1bXAoKTtcbiAgICAgICAgcmV0dXJuIHRlc3RQbHVtcC5hZGRDYWNoZShtZW1zdG9yZSlcbiAgICAgICAgLnRoZW4oKCkgPT4gdGVzdFBsdW1wLnNldFRlcm1pbmFsKGFjdHVhbFN0b3JlKSlcbiAgICAgICAgLnRoZW4oKCkgPT4gdGVzdFBsdW1wLmFkZFR5cGUoVGVzdFR5cGUpKVxuICAgICAgICAudGhlbigoKSA9PiBhY3R1YWxTdG9yZS53cml0ZUF0dHJpYnV0ZXMoeyB0eXBlTmFtZTogJ3Rlc3RzJywgYXR0cmlidXRlczogeyBuYW1lOiAncG90YXRvJyB9IH0pKVxuICAgICAgICAudGhlbigoY3JlYXRlZE9iamVjdCkgPT4ge1xuICAgICAgICAgIHJldHVybiBhY3R1YWxTdG9yZS5yZWFkKHsgdHlwZU5hbWU6ICd0ZXN0cycsIGlkOiBjcmVhdGVkT2JqZWN0LmlkIH0pXG4gICAgICAgICAgLnRoZW4oKCkgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiBzZXRUaW1lb3V0KHJlc29sdmUsIDEwMCkpXG4gICAgICAgICAgICAudGhlbigoKSA9PiB7XG4gICAgICAgICAgICAgIHJldHVybiBleHBlY3QobWVtc3RvcmUucmVhZCh7IHR5cGVOYW1lOiAndGVzdHMnLCBpZDogY3JlYXRlZE9iamVjdC5pZCB9KSlcbiAgICAgICAgICAgICAgLnRvLmV2ZW50dWFsbHkuaGF2ZS5kZWVwLnByb3BlcnR5KCdhdHRyaWJ1dGVzLm5hbWUnLCAncG90YXRvJyk7XG4gICAgICAgICAgICB9KS50aGVuKCgpID0+IHtcbiAgICAgICAgICAgICAgcmV0dXJuIGFjdHVhbFN0b3JlLndyaXRlQXR0cmlidXRlcyh7XG4gICAgICAgICAgICAgICAgdHlwZU5hbWU6ICd0ZXN0cycsXG4gICAgICAgICAgICAgICAgaWQ6IGNyZWF0ZWRPYmplY3QuaWQsXG4gICAgICAgICAgICAgICAgYXR0cmlidXRlczoge1xuICAgICAgICAgICAgICAgICAgbmFtZTogJ2dyb3RhdG8nLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSkudGhlbigoKSA9PiB7XG4gICAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gc2V0VGltZW91dChyZXNvbHZlLCAxMDApKTtcbiAgICAgICAgICAgIH0pLnRoZW4oKCkgPT4ge1xuICAgICAgICAgICAgICByZXR1cm4gZXhwZWN0KG1lbXN0b3JlLnJlYWQoeyB0eXBlTmFtZTogJ3Rlc3RzJywgaWQ6IGNyZWF0ZWRPYmplY3QuaWQgfSkpXG4gICAgICAgICAgICAgIC50by5ldmVudHVhbGx5LmJlLm51bGw7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSlcbiAgICAgICAgLnRoZW4oKCkgPT4ge1xuICAgICAgICAgIHJldHVybiB0ZXN0UGx1bXAudGVhcmRvd24oKTtcbiAgICAgICAgfSlcbiAgICAgICAgLmNhdGNoKChlcnIpID0+IHtcbiAgICAgICAgICB0ZXN0UGx1bXAudGVhcmRvd24oKTtcbiAgICAgICAgICB0aHJvdyBlcnI7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG5cbiAgICAgIGNvbnRleHQuaXQoJ3Nob3VsZCBwYXNzIGJhc2ljIGNhY2hlYWJsZS1yZWFkIGV2ZW50cyB1cCB0aGUgc3RhY2snLCAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHRlc3RQbHVtcCA9IG5ldyBQbHVtcCgpO1xuICAgICAgICBsZXQgdGVzdEl0ZW07XG4gICAgICAgIGxldCBtZW1zdG9yZTtcbiAgICAgICAgcmV0dXJuIHRlc3RQbHVtcC5hZGRUeXBlKFRlc3RUeXBlKVxuICAgICAgICAudGhlbigoKSA9PiBhY3R1YWxTdG9yZS53cml0ZUF0dHJpYnV0ZXMoeyB0eXBlTmFtZTogJ3Rlc3RzJywgYXR0cmlidXRlczogeyBuYW1lOiAncG90YXRvJyB9IH0pKVxuICAgICAgICAudGhlbigoY3JlYXRlZE9iamVjdCkgPT4ge1xuICAgICAgICAgIHRlc3RJdGVtID0gY3JlYXRlZE9iamVjdDtcbiAgICAgICAgICByZXR1cm4gZXhwZWN0KGFjdHVhbFN0b3JlLnJlYWQoeyB0eXBlTmFtZTogJ3Rlc3RzJywgaWQ6IHRlc3RJdGVtLmlkIH0pKVxuICAgICAgICAgIC50by5ldmVudHVhbGx5LmhhdmUuZGVlcC5wcm9wZXJ0eSgnYXR0cmlidXRlcy5uYW1lJywgJ3BvdGF0bycpO1xuICAgICAgICB9KS50aGVuKCgpID0+IHtcbiAgICAgICAgICBtZW1zdG9yZSA9IG5ldyBNZW1vcnlTdG9yZSgpO1xuICAgICAgICAgIHRlc3RQbHVtcC5hZGRDYWNoZShtZW1zdG9yZSk7XG4gICAgICAgICAgdGVzdFBsdW1wLnNldFRlcm1pbmFsKGFjdHVhbFN0b3JlKTtcbiAgICAgICAgICByZXR1cm4gZXhwZWN0KG1lbXN0b3JlLnJlYWQoeyB0eXBlTmFtZTogJ3Rlc3RzJywgaWQ6IHRlc3RJdGVtLmlkIH0pKS50by5ldmVudHVhbGx5LmJlLm51bGw7XG4gICAgICAgIH0pLnRoZW4oKCkgPT4ge1xuICAgICAgICAgIHJldHVybiBhY3R1YWxTdG9yZS5yZWFkKHsgdHlwZU5hbWU6ICd0ZXN0cycsIGlkOiB0ZXN0SXRlbS5pZCB9KTtcbiAgICAgICAgfSlcbiAgICAgICAgLnRoZW4oKCkgPT4ge1xuICAgICAgICAgIC8vIE5PVEU6IHRoaXMgdGltZW91dCBpcyBhIGhhY2ssIGl0IGlzIGJlY2F1c2VcbiAgICAgICAgICAvLyBjYWNoZWFibGUgcmVhZCBldmVudHMgdHJpZ2dlciBtdWx0aXBsZSBhc3luYyB0aGluZ3MsIGJ1dCBkb24ndCBibG9ja1xuICAgICAgICAgIC8vIHRoZSBwcm9taXNlIGZyb20gcmV0dXJuaW5nXG4gICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiBzZXRUaW1lb3V0KHJlc29sdmUsIDEwMCkpO1xuICAgICAgICB9KVxuICAgICAgICAudGhlbigoKSA9PiB7XG4gICAgICAgICAgcmV0dXJuIGV4cGVjdChtZW1zdG9yZS5yZWFkKHsgdHlwZU5hbWU6ICd0ZXN0cycsIGlkOiB0ZXN0SXRlbS5pZCB9KSlcbiAgICAgICAgICAudG8uZXZlbnR1YWxseS5oYXZlLmRlZXAucHJvcGVydHkoJ2F0dHJpYnV0ZXMubmFtZScsICdwb3RhdG8nKTtcbiAgICAgICAgfSlcbiAgICAgICAgLnRoZW4oKCkgPT4ge1xuICAgICAgICAgIHJldHVybiB0ZXN0UGx1bXAudGVhcmRvd24oKTtcbiAgICAgICAgfSlcbiAgICAgICAgLmNhdGNoKChlcnIpID0+IHtcbiAgICAgICAgICB0ZXN0UGx1bXAudGVhcmRvd24oKTtcbiAgICAgICAgICB0aHJvdyBlcnI7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG5cbiAgICAgIGNvbnRleHQuaXQoJ3Nob3VsZCBwYXNzIHdyaXRlLWludmFsaWRhdGlvbiBldmVudHMgb24gaGFzTWFueSByZWxhdGlvbnNoaXBzIHRvIG90aGVyIGRhdGFzdG9yZXMnLCAoKSA9PiB7XG4gICAgICAgIGxldCB0ZXN0SXRlbTtcbiAgICAgICAgY29uc3QgbWVtc3RvcmUgPSBuZXcgTWVtb3J5U3RvcmUoKTtcbiAgICAgICAgY29uc3QgdGVzdFBsdW1wID0gbmV3IFBsdW1wKCk7XG4gICAgICAgIHJldHVybiB0ZXN0UGx1bXAuYWRkVHlwZShUZXN0VHlwZSlcbiAgICAgICAgLnRoZW4oKCkgPT4gdGVzdFBsdW1wLmFkZENhY2hlKG1lbXN0b3JlKSlcbiAgICAgICAgLnRoZW4oKCkgPT4gdGVzdFBsdW1wLnNldFRlcm1pbmFsKGFjdHVhbFN0b3JlKSlcbiAgICAgICAgLnRoZW4oKCkgPT4gYWN0dWFsU3RvcmUud3JpdGVBdHRyaWJ1dGVzKHsgdHlwZU5hbWU6ICd0ZXN0cycsIGF0dHJpYnV0ZXM6IHsgbmFtZTogJ3BvdGF0bycgfSB9KSlcbiAgICAgICAgLnRoZW4oKGNyZWF0ZWRPYmplY3QpID0+IHtcbiAgICAgICAgICB0ZXN0SXRlbSA9IGNyZWF0ZWRPYmplY3Q7XG4gICAgICAgICAgcmV0dXJuIGV4cGVjdChhY3R1YWxTdG9yZS5yZWFkKHsgdHlwZU5hbWU6ICd0ZXN0cycsIGlkOiB0ZXN0SXRlbS5pZCB9KSlcbiAgICAgICAgICAudG8uZXZlbnR1YWxseS5oYXZlLmRlZXAucHJvcGVydHkoJ2F0dHJpYnV0ZXMubmFtZScsICdwb3RhdG8nKTtcbiAgICAgICAgfSkudGhlbigoKSA9PiBhY3R1YWxTdG9yZS53cml0ZVJlbGF0aW9uc2hpcEl0ZW0oeyB0eXBlTmFtZTogJ3Rlc3RzJywgaWQ6IHRlc3RJdGVtLmlkIH0sICdjaGlsZHJlbicsIHsgaWQ6IDEwMCB9KSlcbiAgICAgICAgLnRoZW4oKCkgPT4ge1xuICAgICAgICAgIHJldHVybiBleHBlY3QobWVtc3RvcmUucmVhZCh7IHR5cGVOYW1lOiAndGVzdHMnLCBpZDogdGVzdEl0ZW0uaWQgfSkpXG4gICAgICAgICAgLnRvLmV2ZW50dWFsbHkubm90LmhhdmUuZGVlcC5wcm9wZXJ0eSgncmVsYXRpb25zaGlwcy5jaGlsZHJlbicpO1xuICAgICAgICB9KS50aGVuKCgpID0+IHtcbiAgICAgICAgICByZXR1cm4gYWN0dWFsU3RvcmUucmVhZCh7IHR5cGVOYW1lOiAndGVzdHMnLCBpZDogdGVzdEl0ZW0uaWQgfSwgJ2NoaWxkcmVuJyk7XG4gICAgICAgIH0pLnRoZW4oKCkgPT4ge1xuICAgICAgICAgIC8vIE5PVEU6IHRoaXMgdGltZW91dCBpcyBhIGhhY2ssIGl0IGlzIGJlY2F1c2VcbiAgICAgICAgICAvLyBjYWNoZWFibGUgcmVhZCBldmVudHMgdHJpZ2dlciBtdWx0aXBsZSBhc3luYyB0aGluZ3MsIGJ1dCBkb24ndCBibG9ja1xuICAgICAgICAgIC8vIHRoZSBwcm9taXNlIGZyb20gcmV0dXJuaW5nXG4gICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiBzZXRUaW1lb3V0KHJlc29sdmUsIDEwMCkpO1xuICAgICAgICB9KVxuICAgICAgICAudGhlbigoKSA9PiBtZW1zdG9yZS5yZWFkKHsgdHlwZU5hbWU6ICd0ZXN0cycsIGlkOiB0ZXN0SXRlbS5pZCB9LCAnY2hpbGRyZW4nKSlcbiAgICAgICAgLnRoZW4oKHYpID0+IGV4cGVjdCh2LnJlbGF0aW9uc2hpcHMuY2hpbGRyZW4pLnRvLmRlZXAuZXF1YWwoW3sgaWQ6IDEwMCB9XSkpXG4gICAgICAgIC50aGVuKCgpID0+IGFjdHVhbFN0b3JlLndyaXRlUmVsYXRpb25zaGlwSXRlbSh7IHR5cGVOYW1lOiAndGVzdHMnLCBpZDogdGVzdEl0ZW0uaWQgfSwgJ2NoaWxkcmVuJywgeyBpZDogMTAxIH0pKVxuICAgICAgICAudGhlbigoKSA9PiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gc2V0VGltZW91dChyZXNvbHZlLCAxMDApKSlcbiAgICAgICAgLnRoZW4oKCkgPT4gbWVtc3RvcmUucmVhZCh7IHR5cGVOYW1lOiAndGVzdHMnLCBpZDogdGVzdEl0ZW0uaWQgfSkpXG4gICAgICAgIC50aGVuKCh2KSA9PiBleHBlY3QodikudG8ubm90LmhhdmUuZGVlcC5wcm9wZXJ0eSgncmVsYXRpb25zaGlwcy5jaGlsZHJlbicpKVxuICAgICAgICAudGhlbigoKSA9PiB0ZXN0UGx1bXAudGVhcmRvd24oKSlcbiAgICAgICAgLmNhdGNoKChlcnIpID0+IHtcbiAgICAgICAgICB0ZXN0UGx1bXAudGVhcmRvd24oKTtcbiAgICAgICAgICB0aHJvdyBlcnI7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG5cbiAgICAgIGNvbnRleHQuaXQoJ3Nob3VsZCBwYXNzIGNhY2hlYWJsZS1yZWFkIGV2ZW50cyBvbiBoYXNNYW55IHJlbGF0aW9uc2hpcHMgdG8gb3RoZXIgZGF0YXN0b3JlcycsICgpID0+IHtcbiAgICAgICAgbGV0IHRlc3RJdGVtO1xuICAgICAgICBsZXQgbWVtc3RvcmU7XG4gICAgICAgIGNvbnN0IHRlc3RQbHVtcCA9IG5ldyBQbHVtcCgpO1xuICAgICAgICByZXR1cm4gdGVzdFBsdW1wLmFkZFR5cGUoVGVzdFR5cGUpXG4gICAgICAgIC50aGVuKCgpID0+IGFjdHVhbFN0b3JlLndyaXRlQXR0cmlidXRlcyh7IHR5cGVOYW1lOiAndGVzdHMnLCBhdHRyaWJ1dGVzOiB7IG5hbWU6ICdwb3RhdG8nIH0gfSkpXG4gICAgICAgIC50aGVuKChjcmVhdGVkT2JqZWN0KSA9PiB7XG4gICAgICAgICAgdGVzdEl0ZW0gPSBjcmVhdGVkT2JqZWN0O1xuICAgICAgICAgIHJldHVybiBleHBlY3QoYWN0dWFsU3RvcmUucmVhZCh7IHR5cGVOYW1lOiAndGVzdHMnLCBpZDogdGVzdEl0ZW0uaWQgfSkpXG4gICAgICAgICAgLnRvLmV2ZW50dWFsbHkuaGF2ZS5kZWVwLnByb3BlcnR5KCdhdHRyaWJ1dGVzLm5hbWUnLCAncG90YXRvJyk7XG4gICAgICAgIH0pLnRoZW4oKCkgPT4gYWN0dWFsU3RvcmUud3JpdGVSZWxhdGlvbnNoaXBJdGVtKHsgdHlwZU5hbWU6ICd0ZXN0cycsIGlkOiB0ZXN0SXRlbS5pZCB9LCAnY2hpbGRyZW4nLCB7IGlkOiAxMDAgfSkpXG4gICAgICAgIC50aGVuKCgpID0+IHtcbiAgICAgICAgICBtZW1zdG9yZSA9IG5ldyBNZW1vcnlTdG9yZSgpO1xuICAgICAgICAgIHJldHVybiB0ZXN0UGx1bXAuc2V0VGVybWluYWwoYWN0dWFsU3RvcmUpXG4gICAgICAgICAgLnRoZW4oKCkgPT4gdGVzdFBsdW1wLmFkZENhY2hlKG1lbXN0b3JlKSlcbiAgICAgICAgICAudGhlbigoKSA9PiBleHBlY3QobWVtc3RvcmUucmVhZCh7IHR5cGVOYW1lOiAndGVzdHMnLCBpZDogdGVzdEl0ZW0uaWQgfSkpLnRvLmV2ZW50dWFsbHkuYmUubnVsbCk7XG4gICAgICAgIH0pLnRoZW4oKCkgPT4ge1xuICAgICAgICAgIHJldHVybiBhY3R1YWxTdG9yZS5yZWFkKHsgdHlwZU5hbWU6ICd0ZXN0cycsIGlkOiB0ZXN0SXRlbS5pZCB9LCAnY2hpbGRyZW4nKTtcbiAgICAgICAgfSkudGhlbigoKSA9PiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gc2V0VGltZW91dChyZXNvbHZlLCAxMDApKSlcbiAgICAgICAgLnRoZW4oKCkgPT4gbWVtc3RvcmUucmVhZCh7IHR5cGVOYW1lOiAndGVzdHMnLCBpZDogdGVzdEl0ZW0uaWQgfSwgJ2NoaWxkcmVuJykpXG4gICAgICAgIC50aGVuKCh2KSA9PiBleHBlY3Qodi5yZWxhdGlvbnNoaXBzLmNoaWxkcmVuKS50by5kZWVwLmVxdWFsKFt7IGlkOiAxMDAgfV0pKVxuICAgICAgICAudGhlbigoKSA9PiB0ZXN0UGx1bXAudGVhcmRvd24oKSlcbiAgICAgICAgLmNhdGNoKChlcnIpID0+IHtcbiAgICAgICAgICB0ZXN0UGx1bXAudGVhcmRvd24oKTtcbiAgICAgICAgICB0aHJvdyBlcnI7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBjb250ZXh0LmFmdGVyKCgpID0+IHtcbiAgICAgIHJldHVybiAoc3RvcmUuYWZ0ZXIgfHwgKCgpID0+IHsgcmV0dXJuOyB9KSkoYWN0dWFsU3RvcmUpO1xuICAgIH0pO1xuICB9KTtcbn1cbiJdfQ==
